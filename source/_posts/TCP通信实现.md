title: TCP通信实现
author: weihehe
tags:
  - TCP
categories:
  - 网络
date: 2024-08-16 11:05:00
---
Tcp协议实现
<!--more-->

- Tcp是面向连接的，因此服务器一般是比较“被动的”，即**持续监听**。

- **监听套接字——监听新链接**和**通信套接字——和客户端通信**分离，分别负责不同的功能。



## Tcp中涉及的经典函数

### `listen()` 函数

**原型：**
```cpp
int listen(int sockfd, int backlog);
```

**功能：**
- `listen()` 函数将一个已绑定（`bind()`）的套接字（`sockfd`）设置为被动监听状态，准备接受传入的连接请求。
- 该函数通常在服务器端使用，是创建 TCP 服务器的重要步骤之一。

**参数：**
- `sockfd`：要设置为监听状态的套接字描述符，通常是通过 `socket()` 和 `bind()` 创建并绑定的。
- `backlog`：指定连接队列的最大长度，表示在处理当前连接时，可以有多少个未处理的连接在队列中等待。

**返回值：**
- 成功时返回 `0`，失败时返回 `-1` 并设置 `errno`。

### `accept()` 函数

**原型：**
```cpp
int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);
```

**功能：**
- `accept()` 函数从监听套接字中提取一个已完成的连接请求，生成一个新的套接字用于与客户端进行通信。
- 该函数阻塞调用，直到有新的连接请求进来。

**参数：**
- `sockfd`：监听套接字描述符，之前通过 `listen()` 设置为监听状态。
- `addr`：指向 `sockaddr` 结构体的指针，用于存储客户端的地址信息。可以为 `NULL`，表示不关心客户端地址。
- `addrlen`：指向 `socklen_t` 类型的指针，用于存储 `addr` 的大小。传递 `NULL` 时，表示忽略地址长度。

**返回值：**
- 成功时返回一个新的套接字描述符（用于与客户端通信），失败时返回 `-1` 并设置 `errno`。