title: 数据库表
author: weihehe
tags:
  - 表
categories:
  - 数据库
date: 2024-08-25 21:15:00
---

数据库中表的相关内容
<!--more-->

## 表的创建

```SQL
CREATE TABLE table_name (
field1 datatype comment `comment：为列添加注释，说明该列的用途。`,
field2 datatype,
field3 datatype
) character set 字符集 collate 校验规则 engine 存储引擎;
```
- field 表示列名。
  
- datatype 表示列的类型。
  
- character set 字符集，如果没有指定字符集，则以所在数据库的字符集为准。
  
- collate 校验规则，如果没有指定校验规则，则以所在数据库的校验规则为准。

## 表结构

### 表结构组成：

![表结构](/images/数据库-表结构png.png)

### 查看表结构
```SQL
desc 表名;
```

## 修改表

`ALTER TABLE tablename`

- **ALTER TABLE**：这是用于修改现有表结构的 SQL 命令。通过它，可以对表进行多种修改操作，例如添加或删除列、修改列的数据类型、更改表的约束等。
  
- **tablename**：想要修改的表的名称。需要将这个占位符替换为实际的表名。
  
**注意事项**

1. **列的顺序**：默认情况下，新列会被添加到表的末尾。也可以使用`AFTER`来改变。例如：
	- `AFTER day`：
		- 这部分指定新列 `assets` 的位置，将它添加到 `day` 列之后。也就是说，在表结构中，新列 `assets` 会紧跟在 `day` 列之后出现。
      
2. **表锁**：在大多数情况下，`ALTER TABLE` 操作会锁定表，导致表在操作期间不可用。因此，使用 `ALTER TABLE` 时应注意对生产环境的影响
  
3. **列默认值**：如果没有指定 `DEFAULT` 值，那么新列在插入数据时如果没有值，通常会默认为 `NULL`（除非数据类型不允许 `NULL`）。


| 关键字         | 用途                                                                                       | 说明                                                                                          |
|----------------|--------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------                                 |
| `MODIFY`       | 修改现有列的属性，如数据类型、默认值等                                                     | 用法示例：`MODIFY column_name new_datatype [DEFAULT value]`                                    |                      |
| `DROP`         | 删除表中的列或约束                                                                         | 用法示例：`DROP column_name` 或 `DROP CONSTRAINT constraint_name`                              |
| `CHANGE`       | 修改列名和列的数据类型                                                                    | 用法示例：`alter table student change name gg varchar(64);`                               |
| `FIRST`        | 将新列或修改的列移到表中的第一列位置                                                     | 用法示例：`alter table student add No. int unsigned default 1;`          |
| `RENAME`       | 重命名表或列                                                                              | 用法示例：`RENAME TO new_table_name` 或 `RENAME COLUMN old_name TO new_name`                  |
| `ALTER COLUMN` | 修改列的某些属性（通常与其他关键字结合使用）                                              | 用法示例：`ALTER COLUMN column_name SET DEFAULT value` 或 `ALTER COLUMN column_name DROP DEFAULT` |
| `ENGINE`       | 更改表的存储引擎                                                                          | 用法示例：`ENGINE = new_engine_name`                                                           |
| `CONVERT TO`   | 将表的字符集转换为指定的字符集                                                            | 用法示例：`CONVERT TO CHARACTER SET utf8mb4`                                                   |
| `AUTO_INCREMENT` | 更改 `AUTO_INCREMENT` 的初始值或步长                                                   | 用法示例：`AUTO_INCREMENT = value`                                                             |
| `DROP PRIMARY KEY` | 删除主键约束                                                                          | 用法示例：`DROP PRIMARY KEY`                                                                   |
| `ADD PRIMARY KEY` | 添加主键约束                                                                           | 用法示例：`ADD PRIMARY KEY (column_name)`                                                      |

- `UNSIGNED`：
	- 这表示该列的整数值不允许为负数，因此范围从 0 到正数最大值。如果没有 `UNSIGNED`。
- ` ZEROFILL`：
	- 表示显示宽度，用前导零填充。
		- 例如，如果 `a` 列的值为 `42`，在应用了 `ZEROFILL` 和 `INT(5)` 后，它将显示为 `00042`。
		- 使用 `ZEROFILL` 时，MySQL 会自动将列设为 `UNSIGNED`，即使你未明确指定 `UNSIGNED`，因为负数不能用零填充。


## 表的约束

表的约束是数据库的一种机制，用于确保数据的完整性和一致性。通过合理使用这些约束，可以避免数据错误和维护数据之间的关系，确保数据库的高效和可靠性。

### 1. PRIMARY KEY（主键约束）

- **作用**：用于唯一标识表中的每一行数据。一个表只能有一个主键，但主键可以由多列组成（称为复合主键）。
	- 复合主键
    
![复合主键](/images/数据库-复合主键.png)
- **特点**：
  - 每个主键值必须是唯一的。
  - 主键列不能包含 `NULL` 值。
  - 主键通常被用于建立表与表之间的关系。

### 2. FOREIGN KEY（外键约束）

- **作用**：用于在两个表之间建立关系，确保一个表中的数据与另一个表中的数据保持一致性。
- **特点**：
  - 外键指向另一个表的主键或唯一键。
  - 外键约束可以防止在引用表中删除或更新主键值，从而保证数据的完整性。


### 3. UNIQUE（唯一约束）

- **作用**：确保一列或多列中的数据在表中是唯一的。
- **特点**：
  - 可以在表中设置多个唯一约束。
  - 唯一约束列可以包含 `NULL` 值（但某些数据库中不允许多行 `NULL`）。
  - 用于防止重复数据的插入。

### 4. NOT NULL（非空约束）

- **作用**：确保列中的数据不能为 `NULL`。
- **特点**：
  - 适用于必须有值的字段，如用户名、密码等。
  - `NOT NULL` 约束可与其他约束一起使用（如 `PRIMARY KEY`）。

### 5. CHECK（检查约束）

- **作用**：用于限定列中的数据必须满足的条件。
- **特点**：
  - 例如，确保年龄列的值必须大于 18：`CHECK (age >= 18)`。
  - 某些数据库不完全支持 `CHECK` 约束（如早期版本的 MySQL）。

### 6. DEFAULT（默认值约束）

- **作用**：为列设置一个默认值，当插入数据时如果没有提供该列的值，则使用默认值。
- **特点**：
  - 例如：`DEFAULT CURRENT_TIMESTAMP` 可以用于自动设置创建时间。
  - 可以减少插入数据时的手动输入，确保有意义的默认值。

### 7.**AUTO_INCREMENT（自增约束）**

- **作用**：用于自动生成唯一的递增值，通常用于主键列。
- **特点**：
  - 每插入一行，数值自动加 1（默认情况下）。
  - 仅适用于整数类型的列。
  - 一张表最多只能有一个自增长。

### 约束的使用示例

以下是一个创建表时使用多种约束的示例：

```sql
CREATE TABLE employees (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    hire_date DATE DEFAULT CURRENT_DATE,
    salary DECIMAL(10, 2) CHECK (salary > 0),
    department_id INT,
    FOREIGN KEY (department_id) REFERENCES departments(id)
);
```

#### 解释

- `id` 列是主键，并且值会自动递增。
- `name` 列不能为 `NULL`。
- `email` 列中的值必须唯一。
- `hire_date` 列如果未指定值，则默认为当前日期。
- `salary` 列必须大于 0。
- `department_id` 列是外键，引用 `departments` 表的 `id` 列。

