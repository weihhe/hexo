title: 多继承和菱形继承
author: weihehe
tags:
  - 继承
  - 菱形继承
categories:
  - C++
date: 2024-07-05 16:34:00
---
菱形继承和菱形虚拟继承
<!-- more -->

## 多继承(慎重使用)

一个子类**有两个或以上直接父类**时称这个继承关系为多继承

### 由多继承导致的菱形继承

![菱形继承](/images/菱形继承_1.png)


#### 对象模型
![菱形继承的对象模型](/images/多继承_01.png)

- 数据冗余：数据冗余是指**基类成员的多个副本包含在派生类中的情况**，从而造成的内存资源浪费。
  - 解决方案
    - 虚继承

- 二义性：由于继承时可能有多个同名成员，而在访问时不知道要访问哪一个。

  - **解决方案**：
    - 虚继承
    - 指定基类
  
  
![指定基类解决二义性](/images/多继承_2.png)

### 虚继承


![怎么添加virtual](/images/多继承_3.png)

#### 虚继承的对象模型

![多继承](/images/pasted-11.png)

- 具体对象`d`存放的位置是由编译器来决定的。
- 额外**记录了相对于`A`的偏移量**（途中为十六进制）。
- 为什么要**记录一个指针，指向额外空间用来记录偏移量，而不在所属的对象内直接保存呢？**
	- 目的是为了可以处理更多的冲突变量，便于添加变量。
 
- 这个**记录偏移量的表**，**就叫虚基表。**
- **`A`中保存的是d对象记录的`_a`值**。
 
![upload successful](/images/多继承_4.png)

### 菱形虚拟继承

对于菱形虚拟继承来说，如果想要在B，C中对**A的虚函数进行重写**，**仅仅在B，C中虚函数重写是不行的——编译报错**。

**分析原因对象模型：**：
![**原因**](/images/多继承-菱形虚拟继承.png)

**如果仅仅对`B，C`重写，此时编译器不知道要将`B，C`中哪一个重写的虚函数保存到共享的`A`中。**

想要解决以上问题，**只能让`B，C，D`同时对`A`的虚函数进行重写**，并且最后，**对于一个`D`对象而言**，保存共享的是 **`A`的虚函数表——但其中存放的是`D的虚函数重写`，并且如果`D`想要继续添加自己的虚函数，也不会额外创建虚表，而是直接添加到`A`的虚表中**。

#### 菱形虚拟继承更复杂的情况

B，C**不仅仅重写了A的虚函数，**并且**B，C还有自己单独的虚函数**。

**此时的对象模型**



**运用**

![upload successful](/images/多继承_5.png)

**总结：取到偏移量，再计算地址，再去访问。**